@page "/recipe/{id:guid}"
@inject HttpClient Http
@inject NavigationManager NavManager

@if (recipe == null)
{
    <p><em>Lade ...</em></p>
}
else
{
    <nav class="navbar sticky-top navbar-light bg-light">
        <span class="navbar-brand">@recipe.Name</span>
        <div class="form-inline">
            <button class="btn btn-link" @onclick="(c => NavManager.NavigateTo(recipe.editUrl()))"><i class="oi oi-pencil"></i></button>
            <button class="btn btn-link validation-message" @onclick="(c => showDeleteModal = true)"><i class="oi oi-delete"></i></button>
        </div>
    </nav>
    
    @if (showDeleteModal)
    {
        <div class="modal fade show" style="display: block;">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title">Löschen bestätigen</h4>
                        <button type="button" disabled="@modalDisabled" class="close" data-dismiss="modal" @onclick="(c => showDeleteModal = false)">&times;</button>
                    </div>
                    <div class="modal-body">
                        <p>Wirklich löschen? </p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" disabled="@modalDisabled" class="btn btn-secondary" data-dismiss="modal" @onclick="(c => showDeleteModal = false)">Abbrechen</button>
                        <button type="button" disabled="@modalDisabled" class="btn btn-danger" data-dismiss="modal" @onclick="deleteRecipe">Löschen</button>
                    </div>
                </div>
            </div>
        </div>
    <div class="modal-backdrop fade show"></div>
    }

    <div class="ui grid" id="recipe">
        <div class="four wide column">
            <div class="ui image">
                <img src="https://www.simply-yummy.de/files/styles/tec_frontend_large/public/flammkuchenteig.jpg?itok=uC6QtpfN">
            </div>
        </div>
        <div class="four wide column">
            <h2>Zutaten</h2>
            <div class="ui list">
                @foreach (var ingredient in recipe.Ingredients)
                {
                    <div class="item">
                        <i class="caret right icon"></i>
                        <div class="content">
                            <div class="header">@ingredient.Name</div>
                            <div class="description">@ingredient.Amount @ingredient.Unit</div>
                        </div>
                    </div>
                }
            </div>
        </div>
        <div class="eight wide column">
            <h2>Zubereitung</h2>
            <div class="ui relaxed list" id="steps">
                @foreach (var step in recipe.Steps)
                {
                    <div class="item">
                        <div class="content">
                            <h3 class="header">Schritt @stepCount</h3>
                            <div class="description" style="white-space: pre-line">@step.Description</div>
                        </div>
                    </div>
                    stepCount++;
                }
            </div>
        </div>
    </div>
}

@code {
    [Parameter]
    public Guid id { get; set; }

    private RecipeModel recipe;
    private int stepCount = 1;
    private bool showDeleteModal = false;
    private bool modalDisabled = false;

    private async void deleteRecipe()
    {
        modalDisabled = true;
        HttpResponseMessage response = await Http.DeleteAsync("http://192.168.2.221:8080/recipe/" + recipe.ID.ToString());
        showDeleteModal = false;
        NavManager.NavigateTo("recipe");
    }

    protected override async Task OnInitializedAsync()
    {
        recipe = await Http.GetFromJsonAsync<RecipeModel>("http://192.168.2.221:8080/recipe/" + @id.ToString());
    }
} 